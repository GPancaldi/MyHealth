<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MyHealth</title>
    <link rel="icon" type="image/x-icon" href="/imgs/icon-vaccine.png">
    <link rel="stylesheet" href="/NovaVacina.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Averia+Libre&display=swap" rel="stylesheet">


    <script type="module">

        const botaoMV = document.getElementById("minhaVac") //captura do elemento html

        botaoMV.addEventListener("click", () => {
            window.location.href = "Inicial.html"
        })
        
        const botaoLogout = document.getElementById("logout") //captura do elemento html

        botaoLogout.addEventListener("click", () => {
            window.location.href = "Entrar.html"
        })

        const botaoNV = document.getElementsByClassName("cadastro") //captura do elemento html

        botaoNV[0].addEventListener("click", cadastraVacina)

    function getId(){

       let dados = JSON.parse(localStorage.getItem("dadosVacina"));

        if(dados == null || dados.length == 0){
            return 1
        }
        else{
            var idmax = Math.max(...dados.map(dado => dado.id))
            return idmax + 1
        }
    } 
        
    function cadastraVacina(){
        let dataVacina = document.getElementById("datavac")
        let vacina = document.getElementById("vac")
        let dataProxVacina = document.getElementById("proxVac")
        let imagem = document.getElementById("imagem")
        let dose = document.querySelector('input[name = "radiocheck"]:checked')


        let dados = JSON.parse(localStorage.getItem("dadosVacina"));

        if(dados == null){
            localStorage.setItem("dadosVacina", "[]")
            dados = [];
        }
        
        let registro = {
            dataVac : dataVacina.value,
            nomeVac : vacina.value,
            dataProxVac : dataProxVacina.value,
            imagem : imagem.value,
            doseVac : dose.value,
            id : getId()
        }

        dados.push(registro);

        localStorage.setItem("dadosVacina", JSON.stringify(dados))
        window.location.replace("/Inicial.html")
    }
    
    botaoNV[0].addEventListener("click", cadastraVacina)


    </script>

</head>
<body class="flex-container">
    
    <header class="flex-header">
        <div class="logo">
            <img class="seringa" src="/imgs/icon-vaccine.png" alt="">
            <span>MyHealth</span>        
        </div>
        <div class="header-buttons">
            <button id="minhaVac">Minhas Vacinas</button>
            <button id="logout" >Logout</button>
        </div> 
    </header>

    <main class="flex-main">

            <form class="flex-form">
                <div class="flex-label">
                    <label for="datavac">Data da vacinação</label>
                    <input type="date" name="datavac" id="datavac">
                </div>

                <div class="flex-label">
                    <label for="vac">Vacina</label>
                    <input type="text" name="vac" id="vac">
                </div>

                <div class="flex-radio">
                    <label>Dose</label>

                    <input type="radio" name="radiocheck" id="radio1" value="1a Dose">
                    <label for="radio1">1a Dose</label>

                    <input type="radio" name="radiocheck" id="radio2" value="2a Dose">
                    <label for="radio2">2a Dose</label>

                    <input type="radio" name="radiocheck" id="radio3" value="3a Dose">
                    <label for="radio3">3a Dose</label>

                    <input type="radio" name="radiocheck" id="radio4" value="Reforço">
                    <label for="radio4">Reforço</label>

                    <input type="radio" name="radiocheck" id="radio5" value="Dose unica">
                    <label for="radio5">Dose unica</label>
                </div>

                <div class="flex-label">
                    <div class="input-name" id="imagem" name="imagem"></div>
                        <label for="compvac">Comprovante de vacina</label>
                        <input type="file" name="compvac" id="compvac" onchange='uploadFile(this)'>
                    
                </div>

                <div class="flex-label">
                    <span>Proxima vacinacao</span>
                    <input type="date" name="" id="proxVac">
                </div>
                
                
                <div class="flex-button">
                    <button type="button" class="cadastro">Cadastrar</button>
                </div>
            </form>
    </main>

    <script>
            function uploadFile(fileInput) {
            let fileUploaded = fileInput.files[0];
            const reader = new FileReader();
            reader.addEventListener("load", () => {
                
                document.getElementById("imagem").value = reader.result

            })
            reader.readAsDataURL(fileUploaded);
        }
    </script>
</body>



</html>